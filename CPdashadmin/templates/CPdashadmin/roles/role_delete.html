{% extends 'CPdashadmin/base_admin.html' %}

{% block admin_title %}Eliminar Rol - {{ role.name }}{% endblock %}

{% block content_title %}Eliminar Rol{% endblock %}
{% block content_subtitle %}Confirmar eliminación del rol {{ role.name }}{% endblock %}

{% block admin_content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h6 class="card-title mb-0">
                    <i class="bi bi-exclamation-triangle"></i> Confirmar Eliminación
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <h5 class="alert-heading">
                        <i class="bi bi-exclamation-triangle"></i> ¡Advertencia!
                    </h5>
                    <p class="mb-0">Está a punto de eliminar el rol <strong>"{{ role.name }}"</strong>. Esta acción no se puede deshacer.</p>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6>Información del Rol:</h6>
                        <ul class="list-unstyled">
                            <li><strong>Nombre:</strong> {{ role.name }}</li>
                            <li><strong>Clave:</strong> {{ role.key }}</li>
                            <li><strong>Descripción:</strong> {{ role.description|default:"Sin descripción" }}</li>
                            <li><strong>Empresa:</strong> {{ role.company.name }}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Impacto de la Eliminación:</h6>
                        <ul class="list-unstyled">
                            <li><strong>Usuarios Asignados:</strong> {{ role.userrole_set.count }}</li>
                            <li><strong>Creado:</strong> {{ role.created_at|date:"d/m/Y H:i" }}</li>
                            <li><strong>Última Actualización:</strong> {{ role.updated_at|date:"d/m/Y H:i" }}</li>
                        </ul>
                    </div>
                </div>
                
                {% if role.userrole_set.count > 0 %}
                <div class="alert alert-info">
                    <h6 class="alert-heading">
                        <i class="bi bi-info-circle"></i> Usuarios Afectados
                    </h6>
                    <p class="mb-2">Este rol tiene <strong>{{ role.userrole_set.count }}</strong> usuario(s) asignado(s). Al eliminar el rol:</p>
                    <ul class="mb-0">
                        <li>Los usuarios perderán este rol específico</li>
                        <li>Pueden quedar sin roles asignados</li>
                        <li>Deberán ser reasignados a otros roles</li>
                    </ul>
                </div>
                {% endif %}
                
                <form method="post">
                    {% csrf_token %}
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'CPdashadmin:role_detail' role.id %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash"></i> Eliminar Rol
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Acciones Alternativas -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="bi bi-lightbulb"></i> Acciones Alternativas
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>En lugar de eliminar, puede:</h6>
                        <ul>
                            <li><a href="{% url 'CPdashadmin:role_edit' role.id %}">Editar el rol</a> para cambiar su nombre o descripción</li>
                            <li>Desactivar temporalmente el rol</li>
                            <li>Reasignar usuarios a otros roles</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Si decide eliminar:</h6>
                        <ul>
                            <li>Asegúrese de que no hay usuarios críticos con este rol</li>
                            <li>Considere crear un nuevo rol antes de eliminar este</li>
                            <li>Documente la razón de la eliminación</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    .card {
        background: var(--content-bg);
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .card-header {
        border-bottom: 1px solid var(--border-color);
    }
    
    .alert {
        border: 1px solid var(--border-color);
    }
    
    .alert-warning {
        background-color: rgba(255, 193, 7, 0.1);
        border-color: rgba(255, 193, 7, 0.3);
        color: var(--text-color);
    }
    
    .alert-info {
        background-color: rgba(13, 202, 240, 0.1);
        border-color: rgba(13, 202, 240, 0.3);
        color: var(--text-color);
    }
    
    .list-unstyled li {
        margin-bottom: 0.5rem;
    }
    
    .btn-danger {
        background-color: #dc3545;
        border-color: #dc3545;
    }
    
    .btn-danger:hover {
        background-color: #c82333;
        border-color: #bd2130;
    }
</style>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const deleteButton = form.querySelector('.btn-danger');
    
    // Confirmación adicional antes de eliminar
    deleteButton.addEventListener('click', function(e) {
        const roleName = '{{ role.name }}';
        const userCount = {{ role.userrole_set.count }};
        
        let message = `¿Está completamente seguro de que desea eliminar el rol "${roleName}"?`;
        
        if (userCount > 0) {
            message += `\n\nEste rol tiene ${userCount} usuario(s) asignado(s) que perderán este rol.`;
        }
        
        message += '\n\nEsta acción NO se puede deshacer.';
        
        if (!confirm(message)) {
            e.preventDefault();
            return false;
        }
    });
});
</script>
{% endblock %}
