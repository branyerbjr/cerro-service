{% extends 'base.html' %}

{% block title %}Iniciar Sesión - ServiceNow Cerro Verde{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .login-container {
        background: var(--neutral-light);
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        padding: 3rem;
        width: 100%;
        max-width: 400px;
        position: relative;
        overflow: hidden;
    }
    
    .login-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-light), var(--accent-green));
    }
    
    .login-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .login-header h1 {
        color: var(--primary-dark);
        font-size: 1.8rem;
        font-weight: 300;
        margin-bottom: 0.5rem;
    }
    
    .login-header p {
        color: var(--neutral-gray);
        font-size: 0.9rem;
    }
    
    .company-logo {
        width: 80px;
        height: 60px;
        margin: 0 auto 1rem;
        display: block;
        object-fit: contain;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .form-control {
        border: 2px solid var(--neutral-gray);
        border-radius: 8px;
        padding: 0.75rem;
        width: 100%;
        transition: all 0.3s ease;
        font-size: 1rem;
    }
    
    .form-control:focus {
        border-color: var(--primary-light);
        box-shadow: 0 0 0 0.2rem rgba(128, 182, 161, 0.25);
        outline: none;
    }
    
    .input-group {
        position: relative;
    }
    
    .input-group .form-control {
        padding-right: 2.5rem;
    }
    
    .input-group-text {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary-light);
        cursor: pointer;
        z-index: 10;
    }
    
    .btn-primary {
        background: var(--primary-light);
        border: none;
        border-radius: 8px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        color: var(--neutral-light);
        width: 100%;
        font-size: 1rem;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }
    
    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }
    
    .btn-primary:active {
        transform: translateY(0);
    }
    
    .btn-link {
        color: var(--primary-light);
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.3s ease;
    }
    
    .btn-link:hover {
        color: var(--primary-dark);
    }
    
    .alert {
        border-radius: 8px;
        border: none;
        padding: 1rem;
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
    }
    
    .alert-success {
        background: var(--accent-green);
        color: var(--neutral-light);
    }
    
    .alert-danger {
        background: #dc3545;
        color: var(--neutral-light);
    }
    
    .alert-info {
        background: var(--primary-light);
        color: var(--primary-dark);
    }
    
    .login-footer {
        text-align: center;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--neutral-gray);
        color: var(--neutral-gray);
        font-size: 0.8rem;
    }
    
    .loading {
        display: none;
        text-align: center;
        padding: 1rem;
    }
    
    .spinner-border {
        color: var(--primary-light);
    }
    
    .password-toggle {
        background: none;
        border: none;
        color: var(--primary-light);
        cursor: pointer;
        padding: 0.5rem;
    }
    
    .password-toggle:hover {
        color: var(--primary-dark);
    }
</style>
{% endblock %}

{% block content %}
<div class="login-container">
    <!-- Header -->
    <div class="login-header">
        {% if user.company.logo %}
            <img src="{{ user.company.logo.url }}" alt="Logo" class="company-logo">
        {% endif %}
        <h1>ServiceNow Cerro Verde</h1>
        <p>Inicie sesión para continuar</p>
    </div>
    
    <!-- Mensajes -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
    
    <!-- Formulario de Login -->
    <form method="post" id="login-form">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="username" class="form-label">Usuario</label>
            <input type="text" class="form-control" id="username" name="username" required 
                   placeholder="Ingrese su nombre de usuario" autocomplete="username">
        </div>
        
        <div class="form-group">
            <label for="password" class="form-label">Contraseña</label>
            <div class="input-group">
                <input type="password" class="form-control" id="password" name="password" required 
                       placeholder="Ingrese su contraseña" autocomplete="current-password">
                <button type="button" class="password-toggle" onclick="togglePassword('password')">
                    <i class="bi bi-eye" id="password_icon"></i>
                </button>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary" id="login-btn">
            <span id="login-text">Iniciar Sesión</span>
            <span id="login-spinner" class="loading">
                <span class="spinner-border spinner-border-sm" role="status"></span>
                Iniciando...
            </span>
        </button>
    </form>
    
    <!-- Enlaces adicionales -->
    <div class="text-center mt-3">
        <a href="{% url 'CPlogin:forgot_password' %}" class="btn-link">¿Olvidó su contraseña?</a>
    </div>
    
    <!-- Footer -->
    <div class="login-footer">
        <p>&copy; 2024 ServiceNow Cerro Verde. Todos los derechos reservados.</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// La función togglePassword ahora está disponible globalmente desde base.html

// Mostrar loading al enviar el formulario
document.getElementById('login-form').addEventListener('submit', function() {
    const loginBtn = document.getElementById('login-btn');
    const loginText = document.getElementById('login-text');
    const loginSpinner = document.getElementById('login-spinner');
    
    loginBtn.disabled = true;
    loginText.style.display = 'none';
    loginSpinner.style.display = 'inline-block';
});

// Auto-focus en el campo de usuario
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('username').focus();
});

// Validación en tiempo real
document.getElementById('username').addEventListener('input', function() {
    this.value = this.value.trim();
});

document.getElementById('password').addEventListener('input', function() {
    if (this.value.length > 0) {
        this.classList.add('has-content');
    } else {
        this.classList.remove('has-content');
    }
});
</script>
{% endblock %}
